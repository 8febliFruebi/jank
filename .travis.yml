language: nix

sudo: false

os:
  - linux

cache:
  - apt
  - ${HOME}/vcpkg/installed
  - ${HOME}/.cache/vcpkg/archives
  - vcpkg_installed

before_install:
  - sudo apt-get -y install clang
  - export CC=clang
  - export CXX=clang++

install:
  - |
    export VCPKG_DISABLE_METRICS=1
    git clone https://github.com/Microsoft/vcpkg.git
    ./vcpkg/bootstrap-vcpkg.sh
    ./vcpkg/vcpkg install || true
    tail /home/travis/build/jank-lang/jank/vcpkg/buildtrees/folly/install-x64-linux-dbg-out.log

script:
  - nix-shell --command "./bin/ci/travis"

after_success:
- lein with-profile coverage cloverage --codecov
- bash <(curl -s https://codecov.io/bash) -f target/coverage/codecov.json
